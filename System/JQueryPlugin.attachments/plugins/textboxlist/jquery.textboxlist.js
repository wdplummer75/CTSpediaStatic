"use strict";!function(e){e.fn.extend({textboxlist:function(t){var l=e.extend({},e.TextboxLister.defaults,t);return this.each((function(){e.data(this,"textboxlist")||e.data(this,"textboxlist",new e.TextboxLister(this,l))}))}}),e.TextboxLister=function(t,l){var s=this;return s.input=e(t),t.textboxList=s,s.opts=e.extend({},s.input.data(),s.input.metadata(),l),s.opts.inputName||(s.opts.inputName=s.input.attr("name")),s.container=s.input.wrap("<div />").parent().addClass(s.opts.containerClass).addClass("clearfix"),s.opts.enableClose&&s.container.addClass("jqTextboxListEnableClose"),"manual"===s.opts.sorting&&s.container.sortable({items:"> ."+s.opts.listValueClass,placeholder:"jqTextboxListPlaceholder",forcePlaceholderSize:!0,update:function(t,l){var n=[];e.each(s.container.sortable("toArray",{attribute:"class"}),(function(t,l){var s=[];e.map(l.split(/\s+/),(function(e){s.push("."+e)})),s=s.join(""),e(s).find("input").each((function(){n.push(e(this).val())}))})),s.currentValues=n}}),s.opts.clearControl&&e(s.opts.clearControl).on("click",(function(){return s.clear(),this.blur(),!1})),s.opts.resetControl&&e(s.opts.resetControl).on("click",(function(){return s.reset(),this.blur(),!1})),s.opts.autocomplete?(e.extend(s.opts,{source:s.opts.autocomplete,select:function(t,l){return e.log("TEXTBOXLIST: selected value="+l.item.value+" label="+l.item.label),s.select([l.item.value+"="+l.item.label]),!1}}),s.input.attr("autocomplete","off").autocomplete(s.opts)):e.log("TEXTBOXLIST: no autocomplete"),s.input.bind("keydown.textboxlist",(function(t){if(13===t.keyCode){var l=s.input.val();if(l)return e.log("TEXTBOXLIST: closing suggestion list"),s.opts.autocomplete&&s.input.autocomplete("close"),s.select(l),t.preventDefault(),!1}})),s.input.bind("AddValue",(function(t,l){e.log("TEXTBOXLIST: got add event, val="+l),l&&s.select(l)})),s.input.bind("DeleteValue",(function(e,t){t&&s.deselect([t])})),s.input.bind("Reset",(function(){s.reset()})),s.input.bind("Clear",(function(){s.clear()})),s.currentValues=[],s.titleOfValue=[],s.input.val()&&s.select(s.input.val().split(/\s*,\s*/),!0),s.initialValues=s.currentValues.slice(),s.input.removeClass("foswikiHidden").show(),this},e.TextboxLister.prototype.clear=function(){e.log("TEXTBOXLIST: called clear");this.container.find("."+this.opts.listValueClass).remove(),this.currentValues=[],this.titleOfValue=[],"function"==typeof this.opts.onClear&&(e.log("TEXTBOXLIST: calling onClear handler"),this.opts.onClear(this))},e.TextboxLister.prototype.reset=function(){e.log("TEXTBOXLIST: called reset");this.clear(),this.select(this.initialValues),"function"==typeof this.opts.onReset&&(e.log("TEXTBOXLIST: calling onReseet handler"),this.opts.onReset(this))},e.TextboxLister.prototype.select=function(t,l){e.log("TEXTBOXLIST: called select("+t+") "+typeof t);var s,n,o,i,a,r,u,c,p=this;for("string"==typeof t?t=t.split(/\s*,\s*/):void 0===t&&(t=[]),s=0;s<t.length;s++)a=!1,(o=t[s])&&(i=o,o.match(/^(.*)=(.*)$/)&&(t[s]=o=RegExp.$1,p.titleOfValue["_"+o]=RegExp.$2));if(p.currentValues.length>0){for(s=0;s<t.length;s++)if(a=!1,o=t[s]){for(n=0;n<p.currentValues.length;n++)if(p.currentValues[n]===o){a=!0;break}a||p.currentValues.push(o)}}else for(p.currentValues=[],s=0;s<t.length;s++)(o=t[s])&&p.currentValues.push(o);for(!0===p.opts.sorting&&(p.currentValues=p.currentValues.sort()),e.log("TEXTBOXLIST: self.currentValues="+p.currentValues+" length="+p.currentValues.length),p.container.find("."+p.opts.listValueClass).remove(),s=p.currentValues.length-1;s>=0;s--)(o=p.currentValues[s])&&(i=p.titleOfValue["_"+o]||o,e.log("TEXTBOXLIST: val="+o+" title="+i),c="tag_"+i.replace(/["' ]/,"_"),r=e("<input type='hidden' name='"+p.opts.inputName+"' title='"+i+"' />").val(o),p.input.is(".foswikiMandatory")&&r.addClass("foswikiMandatory"),p.opts.enableClose&&(u=e("<a href='#' title='remove "+i+"'></a>").addClass(p.opts.closeClass).on("click",(function(t){return t.preventDefault(),p.input.trigger("DeleteValue",e(this).parent().find("input").val()),!1}))),e("<span></span>").addClass(p.opts.listValueClass+" "+c).append(r).append(u).append(i).prependTo(p.container));p.input.val(""),l||"function"!=typeof p.opts.onSelect||(e.log("TEXTBOXLIST: calling onSelect handler"),p.opts.onSelect(p)),p.input.trigger("SelectedValue",t)},e.TextboxLister.prototype.deselect=function(t){e.log("TEXTBOXLIST: called deselect("+t+")");var l,s,n,o,i,a=[];if("string"==typeof t&&(t=t.split(/\s*,\s*/)),t.length){for(l=0;l<this.currentValues.length;l++)if(n=this.currentValues[l]){for(o=!1,s=0;s<t.length;s++)if((i=t[s])&&n===i){o=!0;break}!o&&n&&a.push(n)}this.currentValues=a,"function"==typeof this.opts.onDeselect&&(e.log("TEXTBOXLIST: calling onDeselect handler"),this.opts.onDeselect(this)),this.select(a,!0)}},e.TextboxLister.defaults={containerClass:"jqTextboxListContainer",listValueClass:"jqTextboxListValue",closeClass:"jqTextboxListClose",enableClose:!0,sorting:"manual",inputName:void 0,resetControl:void 0,clearControl:void 0,autocomplete:void 0,onClear:void 0,onReset:void 0,onSelect:void 0,onDeselect:void 0}}(jQuery);
