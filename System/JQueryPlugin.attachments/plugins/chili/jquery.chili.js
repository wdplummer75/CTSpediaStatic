!function(e){ChiliBook={version:"2.2",automatic:!0,automaticSelector:"code",lineNumbers:!1,codeLanguage:function(r){var n=e(r).attr("class");return n||""},recipeLoading:!0,recipeFolder:"",replaceSpace:"&#160;",replaceTab:"&#160;&#160;&#160;&#160;",replaceNewLine:"&#160;<br/>",selectionStyle:["position:absolute; z-index:3000; overflow:scroll;","width:16em;","height:9em;","border:1px solid gray;","padding:15px;","background-color:yellow;"].join(" "),defaultReplacement:'<span class="$0">$$</span>',recipes:{},queue:{},unique:function(){return(new Date).valueOf()}},e.fn.chili=function(r){var n=e.extend({},ChiliBook,r||{});function t(r,i,c){function l(e,r,t){var i=e[r][t],a="string"==typeof i._match?i._match:i._match.source;return{recipe:e,blockName:r,stepName:t,exp:"("+a+")",length:1+(a.replace(/\\./g,"%").replace(/\[.*?\]/g,"%").match(/\((?!\?)/g)||[]).length,replacement:i._replace?i._replace:n.defaultReplacement}}function o(e){for(var r=1,n=[],t=0;t<e.length;t++){var a=e[t].exp;a=a.replace(/\\\\|\\(\d+)/g,(function(e,n){return n?"\\"+(r+1+parseInt(n,10)):e})),n.push(a),r+=e[t].length}var c="(?:"+n.join("|")+")";return c="((?:\\s|\\S)*?)"+c+"|((?:\\s|\\S)+)",new RegExp(c,i._case?"g":"gi")}function u(e){return e=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;")}(e),g&&(e=function(e){return e.replace(/ +/g,(function(e){return e.replace(/ /g,g)}))}(e)),e}function p(r,i,c){if(!i)return u(r);var s=i.split("/"),g="",h="",d="";switch(s.length){case 1:g=s[0];break;case 2:g=s[0],h=s[1];break;case 3:g=s[0],h=s[1],d=s[2];break;default:return u(r)}function v(e){var r=a(e),t=n.recipes[r];if(!t)throw{msg:"recipe not available"};return t}try{var m;if(""!=d)return m=""==g?c.recipe:v(g),""==h&&(h=c.blockName),h in m&&d in m[h]?function(e,r,t,i){n.replaceSpace;var a=[l(r,t,i)];return e.replace(o(a),(function(){return f.apply({steps:a},arguments)}))}(r,m,h,d):u(r);if(""!=h)return h in(m=""==g?c.recipe:v(g))?function(e,r,n){return t(e,r,n)}(r,m,h):u(r);if(""!=g)return function(e,r){return t(e,r)}(r,m=v(g))}catch(t){if(t.msg&&"recipe not available"==t.msg){var b="chili_"+n.unique();if(n.recipeLoading){var w=a(g);if(n.queue[w])n.queue[w].push({cue:b,subject:r,module:i,context:c});else try{n.queue[w]=[{cue:b,subject:r,module:i,context:c}],e.ajax({url:w,dataType:"text",success:function(r){n.recipes[w]=window.eval("(function() { var recipe = "+r+"; return recipe; }())");for(var t=n.queue[w],i=0,a=t.length;i<a;i++){var c=p(t[i].subject,t[i].module,t[i].context);n.replaceTab&&(c=c.replace(/\t/g,n.replaceTab)),n.replaceNewLine&&(c=c.replace(/\n/g,n.replaceNewLine)),e("#"+t[i].cue).replaceWith(c)}}})}catch(e){alert("the recipe for '"+g+"' was not found in '"+w+"'")}return'<span id="'+b+'">'+u(r)+"</span>"}return u(r)}return u(r)}}function s(e,r){return r.replace(/(<span\s+class\s*=\s*(["']))((?:(?!__)\w)+\2\s*>)/gi,"$1"+e+"__$3")}function f(){if(!arguments[0])return"";var e,r=this.steps,n=0,t=2,i=arguments[1],a=arguments[arguments.length-3];if(a)return u(a);for(;e=r[n++];){var c=arguments;if(c[t]){var l="";if("function"==typeof e.replacement){for(var o=[],f=0,g=e.length;f<g;f++)o.push(c[t+f]);o.push(c[c.length-2]),o.push(c[c.length-1]),l=e.replacement.apply({x:function(){var r=arguments[0],n=arguments[1],t={recipe:e.recipe,blockName:e.blockName};return p(r,n,t)}},o)}else l=e.replacement.replace(/(\\\$)|(?:\$\$)|(?:\$(\d+))/g,(function(r,n,i){return n?"$":i?"0"==i?e.stepName:u(c[t+parseInt(i,10)]):u(c[t])}));return l=s(e.recipe._name,l),u(i)+l}t+=e.length}}if(c||(c="_main",function(e){var r=e._name;if(!n.queue[r]){var t=["/* Chili -- "+r+" */"];for(var i in e)if(i.search(/^_(?!main\b)/)<0)for(var a in e[i]){var c=e[i][a];if("_style"in c)if(c._style.constructor==String)t.push("."+r+"__"+a+" { "+c._style+" }");else for(var l in c._style)t.push("."+r+"__"+l+" { "+c._style[l]+" }")}(function(e){if(document.createElement){var r=document.createElement("style");if(r.type="text/css",r.styleSheet)r.styleSheet.cssText=e;else{var n=document.createTextNode(e);r.appendChild(n)}document.getElementsByTagName("head")[0].appendChild(r)}})(t=t.join("\n")),n.queue[r]=!0}}(i)),!(c in i))return u(r);var g=n.replaceSpace,h=function(e,r){var n=[];for(var t in e[r])n.push(l(e,r,t));return n}(i,c),d=o(h);return r.replace(d,(function(){return f.apply({steps:h},arguments)}))}function i(r,i){var a=n.recipes[i];if(a){var l=e(r),o=l.text();if(o){o=o.replace(/\r\n?/g,"\n"),l.parent().is("pre")&&(e.browser.safari||(o=o.replace(/^\n/g,"")));var u=t(o,a);n.replaceTab&&(u=u.replace(/\t/g,n.replaceTab)),n.replaceNewLine&&(u=u.replace(/\n/g,n.replaceNewLine)),r.innerHTML=u,(e.browser.msie||e.browser.mozilla)&&function(r){var n=null;e(r).parents().filter("pre").bind("mousedown",(function(){n=this,e.browser.msie?document.selection.empty():window.getSelection().removeAllRanges()})).bind("mouseup",(function(r){if(n&&n==this){n=null;var t="";if(e.browser.msie){if(""==(t=document.selection.createRange().htmlText))return;t=function(r){do{var n=ChiliBook.unique()}while(r.indexOf(n)>-1);var t="";if(/<br/i.test(r)||/<li/i.test(r)){/<br/i.test(r)?r=r.replace(/\<br[^>]*?\>/gi,n):/<li/i.test(r)&&(r=r.replace(/<ol[^>]*?>|<\/ol>|<li[^>]*?>/gi,"").replace(/<\/li>/gi,n));var i=e("<pre>").appendTo("body").hide()[0];i.innerHTML=r,t=e(i).text().replace(new RegExp(n,"g"),"\r\n"),e(i).remove()}return t}(t);var i='<textarea style="STYLE">'}else{if(""==(t=window.getSelection().toString()))return;t=t.replace(/\r/g,"").replace(/^# ?/g,"").replace(/\n# ?/g,"\n");i='<pre style="STYLE">'}var a=e(i.replace(/\bSTYLE\b/,ChiliBook.selectionStyle)).appendTo("body").text(t).attr("id","chili_selection").click((function(){e(this).remove()})),c=r.pageY-Math.round(a.height()/2)+"px",l=r.pageX-Math.round(a.width()/2)+"px";if(a.css({top:c,left:l}),e.browser.msie)a[0].focus(),a[0].select();else{var o=window.getSelection();o.removeAllRanges();var u=document.createRange();u.selectNodeContents(a[0]),o.addRange(u)}}}))}(r);var p=l.parent(),s=p.attr("class"),f=/ln-(\d+)-([\w][\w\-]*)|ln-(\d+)|ln-/.exec(s);if(f){c(r);var g=0;if(f[1]){g=parseInt(f[1],10);var h=e(".ln-"+f[1]+"-"+f[2]),d=h.index(p[0]);h.slice(0,d).each((function(){g+=e(this).find("li").length}))}else g=f[3]?parseInt(f[3],10):1;l.find("ol")[0].start=g,e("body").width(e("body").width()-1).width(e("body").width()+1)}else n.lineNumbers&&c(r)}}}function a(e){return n.recipeFolder+e+".js"}function c(r){function t(e,r,n,t){var i=t?"</span>":"",a="";return e?a="<li>"+t+r+i+"</li>":n&&(a="<li>"+t+n+i+"</li>"),a}var i=e(r).html(),a=/<br>/.test(i)?"<br>":"<BR>",c="<li>"+n.replaceSpace+"</li>",l=i.replace(/(<span [^>]+>)((?:(?:&nbsp;|\xA0)<br>)+)(.*?)(<\/span>)/gi,"$2$1$3$4").replace(/(.*?)(<span .*?>)(.*?)(?:<\/span>(?:&nbsp;|\xA0)<br>|<\/span>)/gi,(function(e,r,n,i){if(/<br>/i.test(i)){var c=r.split(a),l=c.pop();return((r=c.join(a))?r+a:"")+(l+i).replace(/((.*?)(?:&nbsp;|\xA0)<br>)|(.*)/gi,(function(e,r,i,a){return t(r,i,a,n)}))}return e})).replace(/(<li>.*?<\/li>)|((.*?)(?:&nbsp;|\xA0)<br>)|(.+)/gi,(function(e,r,n,i,a){return function(e,r,n,i){return i||t(e,r,n,"")}(n,i,a,r)})).replace(/<li><\/li>/gi,c);r.innerHTML="<ol>"+l+"</ol>"}return this.each((function(){var r=e(this);r.trigger("chili.before_coloring"),function(r){var t=n.codeLanguage(r);if(""!=t){var c=a(t);if(n.recipeLoading){if(n.queue[c])n.queue[c].push(r);else try{n.queue[c]=[r],e.ajax({url:c,dataType:"text",success:function(e){n.recipes[c]=window.eval("(function() { var recipe = "+e+"; return recipe; }())");for(var r=n.queue[c],t=0,a=r.length;t<a;t++)i(r[t],c)}})}catch(e){alert("the recipe for '"+t+"' was not found in '"+c+"'")}i(r,c)}else i(r,c)}}(this),r.trigger("chili.after_coloring")})),this}}(jQuery);
