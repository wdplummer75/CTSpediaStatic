<!DOCTYPE html><html lang="en">
<head>
<title>SiteToolStatistics &lt; System &lt; Foswiki</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.5, user-scalable=yes" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link type="image/x-icon" rel="icon" href="../MISSING RESOURCE System/SiteToolStatistics/favicon.ico"> <link type="image/x-icon" href="../MISSING RESOURCE System/SiteToolStatistics/favicon.ico" rel="shortcut icon">
<link title="edit SiteToolStatistics" href="SiteToolStatistics.html" rel="alternate" type="application/x-wiki">
<meta name="description" content="SiteToolStatistics" />
<link type="text/css" media="all" class="head SMILIESPLUGIN" rel="stylesheet" href="SmiliesPlugin.attachments/smilies.css"><!--SMILIESPLUGIN-->
<style class='head TABLEPLUGIN_default' type="text/css" media="all">
body .foswikiTable {border-width:1px}
body .foswikiTable .tableSortIcon img {padding-left:.3em; vertical-align:text-bottom}
body .foswikiTable td {border-style:solid none; vertical-align:top}
body .foswikiTable th {border-style:none solid; vertical-align:top; background-color:#d6d3cf; color:#000000}
body .foswikiTable th a:link {color:#000000}
body .foswikiTable th a:visited {color:#000000}
body .foswikiTable th a:hover {color:#000000; background-color:#d6d3cf}
body .foswikiTable th.foswikiSortedCol {background-color:#c4c1ba}
body .foswikiTable tr.foswikiTableRowdataBg0 td {background-color:#ffffff}
body .foswikiTable tr.foswikiTableRowdataBg0 td.foswikiSortedCol {background-color:#f7f7f6}
body .foswikiTable tr.foswikiTableRowdataBg1 td {background-color:#f7f7f6}
body .foswikiTable tr.foswikiTableRowdataBg1 td.foswikiSortedCol {background-color:#f0f0ee}
</style><!--TABLEPLUGIN_default-->
<script class="script JQUERYPLUGIN" src="JQueryPlugin.attachments/jquery-2.2.4.js"></script><!--JQUERYPLUGIN-->
<script class="script JQUERYPLUGIN::OBSERVER" src="JQueryPlugin.attachments/plugins/observer/observer.js?version=0.1"></script><!--JQUERYPLUGIN::OBSERVER-->
<script class="script JQUERYPLUGIN::MIGRATE" src="JQueryPlugin.attachments/plugins/migrate/jquery.migrate.js?version=3.3.1"></script><!--JQUERYPLUGIN::MIGRATE-->
<script src="JQueryPlugin.attachments/plugins/foswiki/jquery.foswiki.js?version=3.01" class="script JQUERYPLUGIN::FOSWIKI"></script><!--JQUERYPLUGIN::FOSWIKI-->
<script class="script JQUERYPLUGIN::BROWSER" src="JQueryPlugin.attachments/plugins/browser/jquery.browser.js?version=0.1.0"></script><!--JQUERYPLUGIN::BROWSER-->
<script class='script JQUERYPLUGIN::FOSWIKI::PREFERENCES foswikiPreferences' type='text/json'>{
   "SCRIPTURLPATHS" : {},
   "WEB" : "System",
   "PUBURLPATH" : "/foswiki/pub",
   "USERNAME" : "WikiAdmin",
   "NAMEFILTER" : "[\\\\\\s*?~^$@%`\"'&|<:;>\\[\\]#\\x00-\\x1f]",
   "WIKIUSERNAME" : "Main.WikiAdmin",
   "USERSWEB" : "Main",
   "SERVERTIME" : "08 Feb 2023 - 15:51",
   "TOPIC" : "SiteToolStatistics",
   "WIKINAME" : "WikiAdmin",
   "SKIN" : "natedit,pattern",
   "SCRIPTSUFFIX" : "",
   "SCRIPTURLPATH" : "/foswiki/bin",
   "URLHOST" : "http://biostat1478.dhcp.mc.vanderbilt.edu",
   "SCRIPTURL" : "http://biostat1478.dhcp.mc.vanderbilt.edu/foswiki/bin",
   "SYSTEMWEB" : "System",
   "COOKIEREALM" : "",
   "PUBURL" : "http://biostat1478.dhcp.mc.vanderbilt.edu/foswiki/pub"
}
</script><!--JQUERYPLUGIN::FOSWIKI::PREFERENCES-->
</head>
<body>
<h1 id="Site_Statistics">  Site Statistics </h1>
<div class="foswikiToc" id="foswikiTOC"><span class="foswikiTocTitle">On this page:</span> <ul>
<li> <a href="#Introduction"> Introduction </a>
</li> <li> <a href="#Manually_running_statistics"> Manually running statistics </a>
</li> <li> <a href="#Controlling_access_to_the_statistics_script"> Controlling access to the statistics script </a>
</li> <li> <a href="#Configuring_for_automatic_operation"> Configuring for automatic operation </a>
</li> <li> <a href="#Creating_the_WebStatistics_topics"> Creating the WebStatistics topics </a>
</li> <li> <a href="#Generating_statistics_manually_by_URL"> Generating statistics manually by URL </a>
</li> <li> <a href="#Tailoring_the_WebStatistics_layout"> Tailoring the WebStatistics layout </a> <ul>
<li> <a href="#Restricting_access_to_statistics_topics"> Restricting access to statistics topics </a>
</li></ul> 
</li> <li> <a href="#Managing_the_WebStatistics_topics"> Managing the WebStatistics topics </a>
</li></ul> 
</div>
<p></p>
<h3 id="Introduction">  Introduction </h3>
Statistics of visits to pages in a web can be generated manually or automatically, on a per-web basis. Statistics are compiled as a running total for each month.They include totals for Topic Views, Topic Saves, Attachment Uploads, Most Popular Topics with number of views, and Top Contributors showing total of saves and attachment uploads. Statistics from previous months are saved, and a new row is written to the table at the beginning of each month.
<p></p> <ul>
<li> You can create a WebStatistics link using <code><b>%STATISTICSTOPIC%</b></code>
</li></ul> 
<p></p>
Statistics are compiled by a script that processes the Foswiki event log. The script can be run two ways: <ul>
<li> Manually, by an authorized user from a browser URL
</li> <li> Automatically by a shell script, usually run as a <code>cron</code> job
</li></ul> 
<p></p>
<h3 id="Manually_running_statistics">  Manually running statistics </h3>
The following form can be used to run statistics and create the WebStatistics topics for selected or all webs.
<p></p>
Note:  The current user - <a href="../Main/WikiAdmin.html">WikiAdmin</a> must have access rights to read/write the WebStatistics topics, and if missing, must have authority to create the WebStatistics in the selected webs.
<p></p>
<form name="stats" action="/foswiki/bin/statistics" method="post">
 <div id="runStats" class="foswikiFormSteps">
  <div class="foswikiFormStep">
            <h3>Run statistics on a list of one or more webs</h3>
   <div class="col1">
    <p>
                    <input name="webs" class="foswikiInputField" type="text" value="" size="80" />
    </p>
   </div><!--//col1-->
   <div class="col2">
    <p>
     Enter a comma separated list of webnames. Enter a subweb by specifying <code>ParentWeb/SubWeb/</code>  Web names must follow web naming rules and start with an upper case letter.
    </p>
   </div><!--//col2-->
   <div class="foswikiClear"></div>
  </div><!--//foswikiFormStep-->
  <div class="foswikiFormStep">
            <h3>Additional Settings</h3>
            <div class="additionalSettings">
    <div class="foswikiFormSteps">
                    <div class="foswikiFormStep">
                        <h3>Autocreate missing WebStatistics</h3>
                        <div class="col1">
                            <p>
                                <input type="checkbox" name="autocreate" value="1" />
                            </p>
                        </div><!--//col1-->
                        <div class="col2">
                            <p>
                                Select this option if you want the Statistics script to auto-create the WebStatistics if it is missing. (Note: this operation must be enabled in the configuration).
                            </p>
                        </div><!--//col2-->
                        <div class="foswikiClear"></div>
                    </div><!--//foswikiFormStep-->
     <div class="foswikiFormStep">
      <h3>Process sub-webs</h3>
      <div class="col1">
       <p>
                                <input type="checkbox" name="subwebs" value="1" />
       </p>
      </div><!--//col1-->
      <div class="col2">
       <p>
        Process any subwebs of the requested webs. If this is not selected, then sub-webs must be explicitly listed in the list of webs.
       </p>
      </div><!--//col2-->
                    </div><!--//foswikiFormStep-->
     <div class="foswikiFormStep">
      <h3>Specify date to process</h3>
      <div class="col1">
       <p>
                                <input class="foswikiInputField" type="text" name="logdate" value="" />
       </p>
      </div><!--//col1-->
      <div class="col2">
       <p>
        Specify the date of the logs to process in <code>YYYYMM</code> format. Example: <code>201203</code> to request March 2012.
       </p>
      </div><!--//col2-->
                        <div class="foswikiClear"></div>
                    </div><!--//foswikiFormStep-->
    </div><!--//foswikiFormSteps-->
   </div><!--//additionalSettings-->
  </div><!--//foswikiFormStep-->
  <div class="foswikiFormStep">
   <input type="submit" class="foswikiSubmit" value="Run Statistics" />
  </div><!--//foswikiFormStep-->
 </div><!--//foswikiFormSteps-->
</form>
</noautolink>
<p></p>
<p></p>
<p></p>
<h3 id="Controlling_access_to_the_statistics_script">  Controlling access to the statistics script </h3>
By default, the statistics script may be run by anyone, however the user must have <code>CHANGE</code> permission on the WebStatistics topic. Statistics generation can create a significant workload on the server. In order to further restrict statistics generation:
<p></p> <ul>
<li> Add <code>statistics</code> to the <a href="../.html">configure</a> <code>Security and Authentication</code> tab, <code>Login</code> sub-tab.(This is now the default on Foswiki 1.1.4). This is required to prevent unauthenticated guest users from running <code>statistics</code>. <ul>
<li> If using Apache authentication, be sure to add it to the Apache configuration.
</li></ul> 
</li> <li> If desired, create a Group for users that should be permitted to run the statistics script, or use the AdminGroup.
</li> <li> Visit <a href="../.html">configure</a> <code>Logging and Statistics</code> tab, and set <code>{Stats}{StatisticsGroup}</code> to the group permitted to run statistics. <ul>
<li> Note: Regardless of this setting, members of the AdminGroup can always run statistics.
</li></ul> 
</li></ul> 
<p></p>
<h3 id="Configuring_for_automatic_operation">  Configuring for automatic operation </h3>
You can automatically generate usage statistics for all webs. To enable this:
<p></p> <ul>
<li> By default, the WebStatistics topic must be present in all webs where you want to have statistics. See below for how to create the WebStatistics topic.
</li> <li> Call the <code>bin/statistics</code> script from a cron job, once a day is recommended. This will update the WebStatistics topics in all top level webs. (Sub-webs are not processed by default).
</li> <li> <img src="DocumentGraphics.attachments/warning.png" height="16" alt="ALERT!" title="ALERT!" width="16"> <strong>Caution:</strong> The script <strong>must</strong> run as the same user as the Web Server CGI scripts. This varies by platform, but is typically <code>apache</code>, <code>www</code>. or <code>nobody</code> on many systems.  Verify this before running statistics from the command line or cron.  If the ownership of critical files is changed, it can render the Foswiki server inoperable.
</li> <li> Example crontab entry to process all webs and subwebs containing a WebStatistics topic: <br /> <code>0 0 * * * (cd /path/to/bin; ./statistics -subwebs 1 &gt;/dev/null 2&gt;&amp;1)</code> <ul>
<li> This crontab entry should be installed for the web server user, not <code>root</code>!
</li></ul> 
</li></ul> 
<div class="foswikiHelp">
<img title="TIP" width="16" src="DocumentGraphics.attachments/tip.png" alt="TIP" height="16"> There is a workaround in case you can't run the script as the CGI user. Use the <code>curl</code> or <code>wget</code> tools available on most distributions. These two examples perform the same function using curl and wget in the crontab. You should only use one of them.
<pre>
 0 0 &#42; &#42; &#42; (curl -F webs&#61;Sandbox -F subwebs&#61;1 your.host.com/bin/statistics &#62;/dev/null 2&#62;&#38;1)
 0 0 &#42; &#42; &#42; (wget --post-data &#39;webs&#61;Sandbox&#38;subwebs&#61;1&#39; -O - your.host.com/bin/statistics &#62;dev/null 2&#62;&#38;1)
</pre>
Both <code>curl</code> and <code>wget</code> can perform <code>http</code> authentication, and can log in if you are using Apache login. See the platform documentation for <code>wget</code> or <code>curl</code> for more information. If using Template login, authentication will not be possible, and the CGI request will run as the WikiGuest user. If you use this workaround, the WebStatistics topics you are updating will have to be writable by WikiGuest, and you cannot add <code>statistics</code> to the <code>{AuthScripts}</code> list
<p></p>
If you do not have <code>curl</code> or <code>wget</code> available on your platform, Foswiki provides a very simple script that can post to or get from a web server. It has no authentication capabilities. <img title="ALERT!" width="16" src="DocumentGraphics.attachments/warning.png" height="16" alt="ALERT!"> <strong>Deprecated!</strong> This script is deprecated and may be removed in a future release.<br />
Run the utility <code>tools/geturl.pl</code> in your cron job and specify the URL of the <code>bin/statistics</code> script as a parameter as shown here:
<pre>
   0 0 &#42; &#42; &#42; (cd /path/to/tools; ./geturl.pl POST mydomain.com /urlpath/to/bin/statistics?webs&#61;Sandbox\;subwebs&#61;1 &#62;/dev/null 2&#62;&#38;1)
</pre>
</div>.
<p></p>
When running from the command line or a cron job, you can pass parameters to the script like this:
<pre class="bash">
./statistics -logdate 200605 -webs Userweb,Sandbox -autocreate 1 -subwebs 1
</pre>
<table class="foswikiTable" rules="none">
	<thead>
		<tr class="foswikiTableOdd foswikiTableRowdataBgSorted0 foswikiTableRowdataBg0">
			<th class="foswikiTableCol0 foswikiFirstCol"> <a title="Sort by this column" rel="nofollow" href="../PublishPlugin/publish.html">Parameter</a> </th>
			<th class="foswikiTableCol1"> <a rel="nofollow" href="../PublishPlugin/publish.html" title="Sort by this column">Description</a> </th>
			<th class="foswikiTableCol2 foswikiLastCol"> <a href="../PublishPlugin/publish.html" rel="nofollow" title="Sort by this column">Default</a> </th>
		</tr>
	</thead>
	<tbody>
		<tr class="foswikiTableEven foswikiTableRowdataBgSorted0 foswikiTableRowdataBg0">
			<td class="foswikiTableCol0 foswikiFirstCol"> <code>autocreate</code> </td>
			<td class="foswikiTableCol1"> Flag to request auto-creation of missing WebStatistics topics. 0=false 1=true </td>
			<td class="foswikiTableCol2 foswikiLastCol"> <em>(See logging and statistics page in <code>bin/configure</code>.)</em> </td>
		</tr>
		<tr class="foswikiTableOdd foswikiTableRowdataBgSorted1 foswikiTableRowdataBg1">
			<td class="foswikiTableCol0 foswikiFirstCol"> <code>logdate</code> </td>
			<td class="foswikiTableCol1"> Generate statistics for the specified year/month, spacified as <code>YYYYMM</code> </td>
			<td class="foswikiTableCol2 foswikiLastCol"> <em>current month</em> </td>
		</tr>
		<tr class="foswikiTableEven foswikiTableRowdataBgSorted0 foswikiTableRowdataBg0">
			<td class="foswikiTableCol0 foswikiFirstCol"> <code>subwebs</code> </td>
			<td class="foswikiTableCol1"> Flag to request processing of subwebs of the requested webs. 0=false 1=true </td>
			<td class="foswikiTableCol2 foswikiLastCol"> 0 <em>(Subwebs are not processed)</em> </td>
		</tr>
		<tr class="foswikiTableOdd foswikiTableRowdataBgSorted1 foswikiTableRowdataBg1">
			<td class="foswikiTableCol0 foswikiFirstCol foswikiLast"> <code>webs</code> </td>
			<td class="foswikiTableCol1 foswikiLast"> comma-separated list of webs. </td>
			<td class="foswikiTableCol2 foswikiLastCol foswikiLast"> <em>all accessible webs</em> </td>
		</tr>
	</tbody></table>
<p></p>
<h3 id="Creating_the_WebStatistics_topics">  Creating the WebStatistics topics </h3>
As of release 1.1.4 of Foswiki, the WebStatistics topics are no longer shipped by default. The <code>bin/statistics</code> script can automatically create the required topics when enabled in the configuration, or when requested by URL Parameter <code>autocreate=1</code>.
<p></p> <ul>
<li> If you want the Statistics topic to be automatically created whenever needed, in every web <ul>
<li> Visit <a href="../.html">http://biostat1478.dhcp.mc.vanderbilt.edu/foswiki/bin/configure</a> <code>Logging and Statistics</code> tab, and set <code>{Stats}{AutoCreateTopic}</code> to <code>Always</code>
</li></ul> 
</li></ul> 
<p></p> <ul>
<li> If you want to manually add the WebStatistics topic to a subset of webs <ul>
<li> Visit <a href="../.html">http://biostat1478.dhcp.mc.vanderbilt.edu/foswiki/bin/configure</a> <code>Logging and Statistics</code> tab, and set <code>{Stats}{AutoCreateTopic}</code> to <code>Permitted</code>
</li> <li> Use the below form to run <code>statistics</code> on one or more webs.
</li> <li> or add <code>-autocreate 1</code> to the statistics script as shown above.
</li></ul> 
</li></ul> 
<p></p> <ul>
<li> If yow want to prohibit autocreate of WebStatistics topics <ul>
<li> Visit <a href="../.html">http://biostat1478.dhcp.mc.vanderbilt.edu/foswiki/bin/configure</a> <code>Logging and Statistics</code> and set <code>{Stats}{AutoCreateTopic}</code> to <code>Prohibited</code>
</li> <li> Note:  This is the default behavior.
</li></ul> 
</li></ul> 
<p></p>
<h3 id="Generating_statistics_manually_by_URL">  Generating statistics manually by URL </h3>
The <code>bin/statistics</code> script can also be executed as a CGI script, Use the form at the top of this topic to run statistics.
<p></p>
<div style="foswikiAlert"><img src="DocumentGraphics.attachments/warning.png" height="16" alt="ALERT!" title="ALERT!" width="16"> As of Foswiki 1.1.5, the statistics script must be run using the "post" method. Direct entry of a URL is no longer allowed.</div>
<p></p>
<h3 id="Tailoring_the_WebStatistics_layout">  Tailoring the WebStatistics layout </h3>
The WebStatistics topics are not shipped with Foswiki by default. The topics are created on demand by the statistics script when requested by configuration. The topics are created as follows: <ol>
<li> The Main web is searched for <a class="foswikiNewLink" rel="nofollow" href="../Main/WebStatisticsTemplate.html" title="Create this topic">Main.WebStatisticsTemplate</a> - if this topic does not exist <ul>
<li> The System web is searched for <a href="WebStatisticsTemplate.html">System.WebStatisticsTemplate</a>. (This topic is shipped with Foswiki by default)
</li></ul> 
</li> <li> If <code>{Stats}{AutoCreateTopic}</code> is enabled in the configuration, or the <code>autocreate</code> parameter is passed to the <code>statistics</code> script, then a new WebStatistics is created using the WebStatisticsTemplate topic found in the first step. <ul>
<li> If <code>autocreate</code> is not requested, and the WebStatistics topic does not exist, then statistics will not be computed for the web.
</li></ul> 
</li></ol> 
<p></p>
The template topic contains an <code>%INCLUDE%</code> for help text and table headings, and a critical <code>marker line</code> that defines the columns to be recorded by the statistics script. (This allows the help text or headings to be modified without needing to edit every WebStatistics topic.) <ul>
<li> The WebStatistics topic looks for <a class="foswikiNewLink" rel="nofollow" href="../Main/DefaultWebStatistics.html" title="Create this topic">Main.DefaultWebStatistics</a> - if this topic does not exist. <ul>
<li> The <a href="DefaultWebStatistics.html">System.DefaultWebStatistics</a> is included. (This topic is shipped with Foswiki by default).
</li></ul> 
</li></ul> 
<p></p>
To tailor the help text or column heading, copy <a href="DefaultWebStatistics.html">System.DefaultWebStatistics</a> to <a class="foswikiNewLink" rel="nofollow" href="../Main/DefaultWebStatistics.html" title="Create this topic">Main.DefaultWebStatistics</a> and tailor as desired. This prevents your changes from being lost when Foswiki is updated.
<p></p>
To tailor the actual columns recorded and the order of the columns, copy <a href="WebStatisticsTemplate.html">System.WebStatisticsTemplate</a> to <a class="foswikiNewLink" rel="nofollow" href="../Main/WebStatisticsTemplate.html" title="Create this topic">Main.WebStatisticsTemplate</a> and tailor as desired. Then remove the previous WebStatistics and allow the statistics script to auto-create a new topic based upon the new template.
Alternatively you can edit the WebStatistics in each web.
<p></p>
Statistics are written into the WebStatistics in the following order. <ul>
<li> If a <code><b>marker line</b></code> is found in the topic, statistics are inserted into the topic <em>after</em> the <code>marker line</code>.
</li> <li> If no <code>marker line</code> is present, but the topic contains existing statistics,  the current month is update, or a new month is written <em>after</em> the previous month.
</li> <li> If no <code>marker line</code> is present and no previous statistics exist, a new line is added to the end of the topic.
</li></ul> 
<p></p>
Removal of the marker line causes statistics to be gathered in chronological order (oldest first). By default, statistics are reported in reverse chronological order.
<p></p>
The <code>marker line</code> defines the order of the columns collected by the <code>statistics</code> script. The order of the columns should correspond to the table heading in the <a href="DefaultWebStatistics.html">DefaultWebStatistics</a>. Default marker line is:
<pre>
&#124; &#60;!--statDate--&#62; &#124; &#60;!--statViews--&#62; &#124; &#60;!--statSaves--&#62; &#124; &#60;!--statUploads--&#62; &#124; &#60;!--statTopViews--&#62; &#124; &#60;!--statTopContributors--&#62; &#124;
</pre>
<p></p>
<h4 id="Restricting_access_to_statistics_topics">  Restricting access to statistics topics </h4>
WebStatistics topics can have access controls like other topics.
<p></p>
If you want to have these access settings copied to new WebStatistics topics, follow these steps: <ol>
<li> Copy topic WebStatisticsTemplate from System web to Main web
</li> <li> Edit the topic settings (via the "More" link) and write (if you want to restrict topics views to logged in users):   <pre>
      * Set DENYTOPICVIEW = WikiGuest
</pre>
</li></ol> 
<p></p>
For existing WebStatistics topics you will need to write these settings manually.
<p></p>
<h3 id="Managing_the_WebStatistics_topics">  Managing the WebStatistics topics </h3>
Each WebStatistics topic will continue to grow, a new row added every month. In addition, every update of the statistics topic will create a new entry in the WebStatistics topic revision history. These can become extremely large over time and Foswiki does not provide any mechanism for automatically archiving statistics topics. For good ongoing performance, it is recommended to archive statistics annually: <ul>
<li> Enable <code>{Stats}{AutoCreateTopic}</code> or add  <code>-autocreate 1</code> to the cron job that runs the statistics script.
</li> <li> Rename the WebStatistics to <code>WebStatisticsYYYY</code> at year end.
</li> <li> Optional: Tailor the <a href="DefaultWebStatistics.html">DefaultWebStatistics</a> topic, adding a search for archived statistics, for example:
</li></ul> 
<pre>
&#37;SEARCH{&#34;.&#34; type&#61;&#34;regex&#34; topic&#61;&#34;&#37;STATISTICSTOPIC&#37;&#42;&#34; excludetopic&#61;&#34;&#37;BASETOPIC&#37;&#34; scope&#61;&#34;topic&#34; nonoise&#61;&#34;on&#34; header&#61;&#34;&#42;Other Statistics Topics:&#42;&#34; format&#61;&#34;   &#42; &#36;web.&#36;topic&#34;}&#37;
</pre>
Following these steps will start a fresh statistics topic with a clean revision history.
<p></p>
<hr />
<p></p>
<hr />
<p></p>
</body>